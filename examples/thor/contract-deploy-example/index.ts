import { Address, HexUInt } from '@vechain/sdk-temp/common';
import {
    ThorClient,
    ClauseBuilder,
    PrivateKeySigner
} from '@vechain/sdk-temp/thor';
import abi from './artifacts/abi.json' with { type: 'json' };

const network = 'testnet' as 'testnet' | 'mainnet';

const defaultAdmin = '0x1D6bA668BBAE4996fB53eB56180482167BeaF8eA';
const pauser = '0x1D6bA668BBAE4996fB53eB56180482167BeaF8eA';
const minter = '0x7Bf5FbABD4c56BC43D5A287fb164153ef9C3020b';

const bytecode =
    '608060405234801561000f575f5ffd5b5060405161205838038061205883398101604081905261002e916101c6565b6040518060400160405280601281526020017111195d921d58881058da1a595d995b595b9d60721b8152506040518060400160405280600381526020016244484160e81b815250815f9081610083919061029e565b506001610090828261029e565b5061009f91505f9050846100fe565b506100ca7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a836100fe565b506100f57f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a6826100fe565b50505050610358565b5f828152600c602090815260408083206001600160a01b038516845290915281205460ff166101a2575f838152600c602090815260408083206001600160a01b03861684529091529020805460ff1916600117905561015a3390565b6001600160a01b0316826001600160a01b0316847f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a45060016101a5565b505f5b92915050565b80516001600160a01b03811681146101c1575f5ffd5b919050565b5f5f5f606084860312156101d8575f5ffd5b6101e1846101ab565b92506101ef602085016101ab565b91506101fd604085016101ab565b90509250925092565b634e487b7160e01b5f52604160045260245ffd5b600181811c9082168061022e57607f821691505b60208210810361024c57634e487b7160e01b5f52602260045260245ffd5b50919050565b601f82111561029957805f5260205f20601f840160051c810160208510156102775750805b601f840160051c820191505b81811015610296575f8155600101610283565b50505b505050565b81516001600160401b038111156102b7576102b7610206565b6102cb816102c5845461021a565b84610252565b6020601f8211600181146102fd575f83156102e65750848201515b5f19600385901b1c1916600184901b178455610296565b5f84815260208120601f198516915b8281101561032c578785015182556020948501946001909201910161030c565b508482101561034957868401515f19600387901b60f8161c191681555b50505050600190811b01905550565b611cf3806103655f395ff3fe608060405234801561000f575f5ffd5b50600436106101d1575f3560e01c80635c975abb116100fe578063a22cb4651161009e578063d53913931161006e578063d5391393146103cd578063d547741f146103f4578063e63ab1e914610407578063e985e9c51461042e575f5ffd5b8063a22cb46514610381578063b88d4fde14610394578063c87b56dd146103a7578063d204c45e146103ba575f5ffd5b80638456cb59116100d95780638456cb591461035757806391d148541461035f57806395d89b4114610372578063a217fddf1461037a575f5ffd5b80635c975abb146103265780636352211e1461033157806370a0823114610344575f5ffd5b8063248a9ca3116101745780633f4ba83a116101445780633f4ba83a146102e557806342842e0e146102ed57806342966c68146103005780634f6ccce714610313575f5ffd5b8063248a9ca31461028a5780632f2ff15d146102ac5780632f745c59146102bf57806336568abe146102d2575f5ffd5b8063095ea7b3116101af578063095ea7b31461023d57806318160ddd1461025257806318e97fd11461026457806323b872dd14610277575f5ffd5b806301ffc9a7146101d557806306fdde03146101fd578063081812fc14610212575b5f5ffd5b6101e86101e3366004611771565b610441565b60405190151581526020015b60405180910390f35b610205610451565b6040516101f491906117ba565b6102256102203660046117cc565b6104e0565b6040516001600160a01b0390911681526020016101f4565b61025061024b3660046117fe565b610507565b005b6008545b6040519081526020016101f4565b6102506102723660046118cf565b610516565b610250610285366004611913565b61054f565b6102566102983660046117cc565b5f908152600c602052604090206001015490565b6102506102ba36600461194d565b6105dd565b6102566102cd3660046117fe565b610601565b6102506102e036600461194d565b610664565b610250610697565b6102506102fb366004611913565b6106cc565b61025061030e3660046117cc565b6106e6565b6102566103213660046117cc565b6106f1565b600b5460ff166101e8565b61022561033f3660046117cc565b610746565b610256610352366004611977565b610750565b610250610795565b6101e861036d36600461194d565b6107c7565b6102056107f1565b6102565f81565b61025061038f366004611990565b610800565b6102506103a23660046119c9565b61080b565b6102056103b53660046117cc565b610823565b6102566103c8366004611a40565b61082e565b6102567f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a681565b61025061040236600461194d565b61088b565b6102567f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a81565b6101e861043c366004611a75565b6108af565b5f61044b826108dc565b92915050565b60605f805461045f90611a9d565b80601f016020809104026020016040519081016040528092919081815260200182805461048b90611a9d565b80156104d65780601f106104ad576101008083540402835291602001916104d6565b820191905f5260205f20905b8154815290600101906020018083116104b957829003601f168201915b5050505050905090565b5f6104ea82610900565b505f828152600460205260409020546001600160a01b031661044b565b610512828233610938565b5050565b7f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a661054081610945565b61054a838361094f565b505050565b6001600160a01b03821661057d57604051633250574960e11b81525f60048201526024015b60405180910390fd5b5f61058983833361099e565b9050836001600160a01b0316816001600160a01b0316146105d7576040516364283d7b60e01b81526001600160a01b0380861660048301526024820184905282166044820152606401610574565b50505050565b5f828152600c60205260409020600101546105f781610945565b6105d78383610a7a565b5f61060b83610750565b821061063c5760405163295f44f760e21b81526001600160a01b038416600482015260248101839052604401610574565b506001600160a01b03919091165f908152600660209081526040808320938352929052205490565b6001600160a01b038116331461068d5760405163334bd91960e11b815260040160405180910390fd5b61054a8282610b0b565b7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a6106c181610945565b6106c9610b76565b50565b61054a83838360405180602001604052805f81525061080b565b6105125f823361099e565b5f6106fb60085490565b82106107235760405163295f44f760e21b81525f600482015260248101839052604401610574565b6008828154811061073657610736611ad5565b905f5260205f2001549050919050565b5f61044b82610900565b5f6001600160a01b03821661077a576040516322718ad960e21b81525f6004820152602401610574565b506001600160a01b03165f9081526003602052604090205490565b7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a6107bf81610945565b6106c9610bc8565b5f918252600c602090815260408084206001600160a01b0393909316845291905290205460ff1690565b60606001805461045f90611a9d565b610512338383610c05565b61081684848461054f565b6105d73385858585610ca3565b606061044b82610dcb565b5f7f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a661085981610945565b600d80545f918261086983611afd565b9190505590506108798582610ece565b610883818561094f565b949350505050565b5f828152600c60205260409020600101546108a581610945565b6105d78383610b0b565b6001600160a01b039182165f90815260056020908152604080832093909416825291909152205460ff1690565b5f6001600160e01b03198216637965db0b60e01b148061044b575061044b82610ee7565b5f818152600260205260408120546001600160a01b03168061044b57604051637e27328960e01b815260048101849052602401610574565b61054a8383836001610f0b565b6106c9813361100f565b5f828152600a602052604090206109668282611b59565b506040518281527ff8e1a15aba9398e019f0b49df1a4fde98ee17ae345cb5f6b5e2c27f5033e8ce79060200160405180910390a15050565b5f6109a884610750565b156109eb5760405162461bcd60e51b8152602060048201526013602482015272105b1c9958591e481bdddb9cc8185b88139195606a1b6044820152606401610574565b5f838152600260205260409020546001600160a01b03168015801590610a1957506001600160a01b03851615155b15610a665760405162461bcd60e51b815260206004820152601b60248201527f536f756c626f756e643a206e6f6e2d7472616e7366657261626c6500000000006044820152606401610574565b610a71858585611048565b95945050505050565b5f610a8583836107c7565b610b04575f838152600c602090815260408083206001600160a01b03861684529091529020805460ff19166001179055610abc3390565b6001600160a01b0316826001600160a01b0316847f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a450600161044b565b505f61044b565b5f610b1683836107c7565b15610b04575f838152600c602090815260408083206001600160a01b0386168085529252808320805460ff1916905551339286917ff6391f5c32d9c69d2a47ea670b442974b53935d1edc7fd64eb21e047a839171b9190a450600161044b565b610b7e61105c565b600b805460ff191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b610bd0611081565b600b805460ff191660011790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a258610bab3390565b6001600160a01b038216610c3757604051630b61174360e31b81526001600160a01b0383166004820152602401610574565b6001600160a01b038381165f81815260056020908152604080832094871680845294825291829020805460ff191686151590811790915591519182527f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31910160405180910390a3505050565b6001600160a01b0383163b15610dc457604051630a85bd0160e11b81526001600160a01b0384169063150b7a0290610ce5908890889087908790600401611c14565b6020604051808303815f875af1925050508015610d1f575060408051601f3d908101601f19168201909252610d1c91810190611c50565b60015b610d86573d808015610d4c576040519150601f19603f3d011682016040523d82523d5f602084013e610d51565b606091505b5080515f03610d7e57604051633250574960e11b81526001600160a01b0385166004820152602401610574565b805160208201fd5b6001600160e01b03198116630a85bd0160e11b14610dc257604051633250574960e11b81526001600160a01b0385166004820152602401610574565b505b5050505050565b6060610dd682610900565b505f828152600a602052604081208054610def90611a9d565b80601f0160208091040260200160405190810160405280929190818152602001828054610e1b90611a9d565b8015610e665780601f10610e3d57610100808354040283529160200191610e66565b820191905f5260205f20905b815481529060010190602001808311610e4957829003601f168201915b505050505090505f610e8260408051602081019091525f815290565b905080515f03610e93575092915050565b815115610ec5578082604051602001610ead929190611c82565b60405160208183030381529060405292505050919050565b610883846110a5565b610512828260405180602001604052805f815250611116565b5f6001600160e01b03198216632483248360e11b148061044b575061044b8261112d565b8080610f1f57506001600160a01b03821615155b15610fe0575f610f2e84610900565b90506001600160a01b03831615801590610f5a5750826001600160a01b0316816001600160a01b031614155b8015610f6d5750610f6b81846108af565b155b15610f965760405163a9fbf51f60e01b81526001600160a01b0384166004820152602401610574565b8115610fde5783856001600160a01b0316826001600160a01b03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45b505b50505f90815260046020526040902080546001600160a01b0319166001600160a01b0392909216919091179055565b61101982826107c7565b6105125760405163e2517d3f60e01b81526001600160a01b038216600482015260248101839052604401610574565b5f611051611081565b610883848484611151565b600b5460ff1661107f57604051638dfc202b60e01b815260040160405180910390fd5b565b600b5460ff161561107f5760405163d93c066560e01b815260040160405180910390fd5b60606110b082610900565b505f6110c660408051602081019091525f815290565b90505f8151116110e45760405180602001604052805f81525061110f565b806110ee8461121c565b6040516020016110ff929190611c82565b6040516020818303038152906040525b9392505050565b61112083836112ac565b61054a335f858585610ca3565b5f6001600160e01b0319821663780e9d6360e01b148061044b575061044b8261130d565b5f5f61115e85858561135c565b90506001600160a01b0381166111ba576111b584600880545f838152600960205260408120829055600182018355919091527ff3f7a9fe364faab93b216da50a3214154f22a0a2b415b23a84c8169e8b636ee30155565b6111dd565b846001600160a01b0316816001600160a01b0316146111dd576111dd818561144e565b6001600160a01b0385166111f9576111f4846114cb565b610883565b846001600160a01b0316816001600160a01b031614610883576108838585611572565b60605f611228836115c0565b60010190505f8167ffffffffffffffff81111561124757611247611826565b6040519080825280601f01601f191660200182016040528015611271576020820181803683370190505b5090508181016020015b5f19016f181899199a1a9b1b9c1cb0b131b232b360811b600a86061a8153600a850494508461127b57509392505050565b6001600160a01b0382166112d557604051633250574960e11b81525f6004820152602401610574565b5f6112e183835f61099e565b90506001600160a01b0381161561054a576040516339e3563760e11b81525f6004820152602401610574565b5f6001600160e01b031982166380ac58cd60e01b148061133d57506001600160e01b03198216635b5e139f60e01b145b8061044b57506301ffc9a760e01b6001600160e01b031983161461044b565b5f828152600260205260408120546001600160a01b039081169083161561138857611388818486611697565b6001600160a01b038116156113c2576113a35f855f5f610f0b565b6001600160a01b0381165f90815260036020526040902080545f190190555b6001600160a01b038516156113f0576001600160a01b0385165f908152600360205260409020805460010190555b5f8481526002602052604080822080546001600160a01b0319166001600160a01b0389811691821790925591518793918516917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef91a4949350505050565b5f61145883610750565b5f838152600760209081526040808320546001600160a01b03881684526006909252909120919250908183146114ad575f83815260208281526040808320548584528184208190558352600790915290208290555b5f938452600760209081526040808620869055938552525081205550565b6008545f906114dc90600190611c96565b5f838152600960205260408120546008805493945090928490811061150357611503611ad5565b905f5260205f2001549050806008838154811061152257611522611ad5565b5f91825260208083209091019290925582815260099091526040808220849055858252812055600880548061155957611559611ca9565b600190038181905f5260205f20015f9055905550505050565b5f600161157e84610750565b6115889190611c96565b6001600160a01b039093165f908152600660209081526040808320868452825280832085905593825260079052919091209190915550565b5f8072184f03e93ff9f4daa797ed6e38ed64bf6a1f0160401b83106115fe5772184f03e93ff9f4daa797ed6e38ed64bf6a1f0160401b830492506040015b6d04ee2d6d415b85acef8100000000831061162a576d04ee2d6d415b85acef8100000000830492506020015b662386f26fc10000831061164857662386f26fc10000830492506010015b6305f5e1008310611660576305f5e100830492506008015b612710831061167457612710830492506004015b60648310611686576064830492506002015b600a831061044b5760010192915050565b6116a28383836116fb565b61054a576001600160a01b0383166116d057604051637e27328960e01b815260048101829052602401610574565b60405163177e802f60e01b81526001600160a01b038316600482015260248101829052604401610574565b5f6001600160a01b038316158015906108835750826001600160a01b0316846001600160a01b03161480611734575061173484846108af565b806108835750505f908152600460205260409020546001600160a01b03908116911614919050565b6001600160e01b0319811681146106c9575f5ffd5b5f60208284031215611781575f5ffd5b813561110f8161175c565b5f81518084528060208401602086015e5f602082860101526020601f19601f83011685010191505092915050565b602081525f61110f602083018461178c565b5f602082840312156117dc575f5ffd5b5035919050565b80356001600160a01b03811681146117f9575f5ffd5b919050565b5f5f6040838503121561180f575f5ffd5b611818836117e3565b946020939093013593505050565b634e487b7160e01b5f52604160045260245ffd5b5f5f67ffffffffffffffff84111561185457611854611826565b50604051601f19601f85018116603f0116810181811067ffffffffffffffff8211171561188357611883611826565b60405283815290508082840185101561189a575f5ffd5b838360208301375f60208583010152509392505050565b5f82601f8301126118c0575f5ffd5b61110f8383356020850161183a565b5f5f604083850312156118e0575f5ffd5b82359150602083013567ffffffffffffffff8111156118fd575f5ffd5b611909858286016118b1565b9150509250929050565b5f5f5f60608486031215611925575f5ffd5b61192e846117e3565b925061193c602085016117e3565b929592945050506040919091013590565b5f5f6040838503121561195e575f5ffd5b8235915061196e602084016117e3565b90509250929050565b5f60208284031215611987575f5ffd5b61110f826117e3565b5f5f604083850312156119a1575f5ffd5b6119aa836117e3565b9150602083013580151581146119be575f5ffd5b809150509250929050565b5f5f5f5f608085870312156119dc575f5ffd5b6119e5856117e3565b93506119f3602086016117e3565b925060408501359150606085013567ffffffffffffffff811115611a15575f5ffd5b8501601f81018713611a25575f5ffd5b611a348782356020840161183a565b91505092959194509250565b5f5f60408385031215611a51575f5ffd5b611a5a836117e3565b9150602083013567ffffffffffffffff8111156118fd575f5ffd5b5f5f60408385031215611a86575f5ffd5b611a8f836117e3565b915061196e602084016117e3565b600181811c90821680611ab157607f821691505b602082108103611acf57634e487b7160e01b5f52602260045260245ffd5b50919050565b634e487b7160e01b5f52603260045260245ffd5b634e487b7160e01b5f52601160045260245ffd5b5f60018201611b0e57611b0e611ae9565b5060010190565b601f82111561054a57805f5260205f20601f840160051c81016020851015611b3a5750805b601f840160051c820191505b81811015610dc4575f8155600101611b46565b815167ffffffffffffffff811115611b7357611b73611826565b611b8781611b818454611a9d565b84611b15565b6020601f821160018114611bb9575f8315611ba25750848201515b5f19600385901b1c1916600184901b178455610dc4565b5f84815260208120601f198516915b82811015611be85787850151825560209485019460019092019101611bc8565b5084821015611c0557868401515f19600387901b60f8161c191681555b50505050600190811b01905550565b6001600160a01b03858116825284166020820152604081018390526080606082018190525f90611c469083018461178c565b9695505050505050565b5f60208284031215611c60575f5ffd5b815161110f8161175c565b5f81518060208401855e5f93019283525090919050565b5f610883611c908386611c6b565b84611c6b565b8181038181111561044b5761044b611ae9565b634e487b7160e01b5f52603160045260245ffdfea2646970667358221220cc05b4a1a730bae0ce785c18b3cb94ad5dd3e31ee8308f9915e5ea492c35b0d964736f6c634300081e0033';

let privateKey: Uint8Array;
let address: string;
let thorUrl: string;

switch (network) {
    case 'testnet':
        // Testnet
        privateKey = HexUInt.of(
            'f9fc826b63a35413541d92d2bfb6661128cd5075fcdca583446d20c59994ba26'
        ).bytes;
        address = '0x7a28e7361fd10f4f058f9fefc77544349ecff5d6';
        thorUrl = 'https://testnet.vechain.org/';
        break;
    case 'mainnet':
        // Mainnet
        privateKey = HexUInt.of(
            '2153c1e49c14d92e8b558750e4ec3dc9b5a6ac4c13d24a71e0fa4f90f4a384b5'
        ).bytes;
        address = '0x571E3E1fBE342891778151f037967E107fb89bd0';
        thorUrl = 'https://mainnet.vechain.org/';
        break;
    default:
        throw new Error('Unsupported network');
}

const assignedMinter = minter ? minter : address;

const thorClient = ThorClient.at(thorUrl);
const signer = new PrivateKeySigner(privateKey);

// Find constructor in ABI
const constructorAbi = abi.find((item) => item.type === 'constructor');
let deployParams;

if (constructorAbi && constructorAbi.inputs && constructorAbi.inputs.length > 0) {
    const constructorArgs = [
        Address.of(defaultAdmin).toString(),
        Address.of(pauser).toString(),
        Address.of(assignedMinter).toString()
    ];

    if (constructorArgs.length !== constructorAbi.inputs.length) {
        throw new Error(
            `Constructor expects ${constructorAbi.inputs.length} arguments, but ${constructorArgs.length} were provided`
        );
    }

    deployParams = {
        types: constructorAbi.inputs,
        values: constructorArgs
    };
}

// Create deployment clause
const deployClause = ClauseBuilder.deployContract(
    HexUInt.of(bytecode),
    deployParams
);

// Deploy contract
// Note: caller is automatically taken from signer.address
const txId = await thorClient.transactions.executeClauses(
    [deployClause],
    signer,
    {}
);

console.log('Transaction ID:', txId.toString());

// Wait for transaction receipt
const receipt = await thorClient.transactions.waitForTransactionReceipt(txId);

if (!receipt) {
    throw new Error('Transaction receipt not found');
}

if (receipt.reverted) {
    throw new Error('Transaction reverted');
}

if (!receipt.outputs || receipt.outputs.length === 0) {
    throw new Error('No contract address in receipt');
}

const contractAddress = receipt.outputs[0].contractAddress;
console.log('Contract deployed at:', contractAddress?.toString());
